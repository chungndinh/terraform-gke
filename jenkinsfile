pipeline {

  agent any
  tools {
  terraform 'terraform'
  }
  environment {
    GOOGLE_APPLICATION_CREDENTIALS = credentials('key-terraform')
  }  
  stages {
    stage('Init') {
      steps {
	  sh 'echo $GOOGLE_APPLICATION_CREDENTIALS'
          sh 'ls'
          sh 'terraform init'
          sh 'terraform plan -out myplan'
        
      }      
    }
    stage('Apply') {
      steps {
          sh 'terraform apply --auto-approve'
        
      }      
    }
   }

}

